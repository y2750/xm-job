

## 📋 自由职业者外包平台 - 后端改造方案

### 一、**项目现状分析**

当前项目是基于 Spring Boot 3.3.1 + MyBatis + MySQL 的**招聘平台**，有以下结构：

- **用户系统**：Admin（管理员）、Employ（企业）、User（求职者）
- **业务模块**：Position（职位）、Resume（简历）、Submit（投递）等
- **依赖**：JWT认证、PageHelper分页、Knife4j文档

------

### 二、**改造方向对标**

| 现有模块         | 新平台对标                   |
| ---------------- | ---------------------------- |
| Position（职位） | **Project**（外包项目）      |
| Resume（简历）   | **Portfolio**（作品集）      |
| Submit（投递）   | **Submission**（稿件投递）   |
| User（求职者）   | **Freelancer**（自由职业者） |
| Employ（企业）   | **Enterprise**（企业）       |

### 三、**需要新增的数据库表**

-- 1. 稿件表（核心新增）
CREATE TABLE submission (
  id INT PRIMARY KEY AUTO_INCREMENT COMMENT '稿件ID',
  project_id INT COMMENT '项目ID',
  freelancer_id INT COMMENT '自由职业者ID',
  title VARCHAR(255) COMMENT '稿件标题',
  description LONGTEXT COMMENT '完成思路/文字描述',
  quote_price DECIMAL(10,2) COMMENT '报价（可选）',
  status VARCHAR(50) COMMENT '状态：SUBMITTED/INTERESTED/REJECTED/CONFIRMED',
  created_at TIMESTAMP COMMENT '提交时间',
  updated_at TIMESTAMP COMMENT '更新时间',
  FOREIGN KEY (project_id) REFERENCES project(id),
  FOREIGN KEY (freelancer_id) REFERENCES freelancer(id)
);

-- 2. 稿件附件表
CREATE TABLE submission_attachment (
  id INT PRIMARY KEY AUTO_INCREMENT COMMENT '附件ID',
  submission_id INT COMMENT '稿件ID',
  file_url VARCHAR(500) COMMENT '文件URL',
  file_name VARCHAR(255) COMMENT '原文件名',
  file_size BIGINT COMMENT '文件大小(bytes)',
  file_type VARCHAR(50) COMMENT '文件类型(ext)',
  upload_time TIMESTAMP COMMENT '上传时间',
  FOREIGN KEY (submission_id) REFERENCES submission(id)
);

-- 3. 外包项目表（改造Position）
CREATE TABLE project (
  id INT PRIMARY KEY AUTO_INCREMENT COMMENT '项目ID',
  enterprise_id INT COMMENT '发布企业ID',
  title VARCHAR(255) COMMENT '项目标题',
  description LONGTEXT COMMENT '项目描述',
  skills_required VARCHAR(255) COMMENT '所需技能标签(逗号分隔)',
  budget_min DECIMAL(10,2) COMMENT '预算下限',
  budget_max DECIMAL(10,2) COMMENT '预算上限',
  deadline DATETIME COMMENT '截止时间',
  delivery_requirement LONGTEXT COMMENT '交付要求',
  status VARCHAR(50) COMMENT '状态：PUBLISHED/CLOSED/CONFIRMED',
  confirmed_freelancer_id INT COMMENT '确定合作的自由职业者ID',
  created_at TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP COMMENT '更新时间',
  FOREIGN KEY (enterprise_id) REFERENCES enterprise(id),
  FOREIGN KEY (confirmed_freelancer_id) REFERENCES freelancer(id)
);

-- 4. 自由职业者表（扩展User）
CREATE TABLE freelancer (
  id INT PRIMARY KEY AUTO_INCREMENT COMMENT '自由职业者ID',
  user_id INT COMMENT '关联User表ID',
  skills VARCHAR(255) COMMENT '技能标签(逗号分隔)',
  portfolio_url VARCHAR(500) COMMENT '作品集链接',
  portfolio_count INT COMMENT '作品数量',
  verified BOOLEAN COMMENT '是否认证',
  verified_at TIMESTAMP COMMENT '认证时间',
  verification_info LONGTEXT COMMENT '认证信息(JSON)',
  rating DECIMAL(3,2) COMMENT '评分',
  completed_projects INT COMMENT '完成项目数',
  FOREIGN KEY (user_id) REFERENCES user(id)
);

-- 5. 企业表（扩展Employ）
CREATE TABLE enterprise (
  id INT PRIMARY KEY AUTO_INCREMENT COMMENT '企业ID',
  employ_id INT COMMENT '关联Employ表ID',
  business_license VARCHAR(255) COMMENT '营业执照',
  verified BOOLEAN COMMENT '是否认证',
  verified_at TIMESTAMP COMMENT '认证时间',
  FOREIGN KEY (employ_id) REFERENCES employ(id)
);

-- 6. 消息表（用于企业与自由职业者沟通）
CREATE TABLE message (
  id INT PRIMARY KEY AUTO_INCREMENT COMMENT '消息ID',
  project_id INT COMMENT '项目ID',
  submission_id INT COMMENT '稿件ID',
  sender_id INT COMMENT '发送者ID',
  sender_type VARCHAR(20) COMMENT '发送者类型：ENTERPRISE/FREELANCER',
  recipient_id INT COMMENT '接收者ID',
  content LONGTEXT COMMENT '消息内容',
  is_read BOOLEAN DEFAULT FALSE COMMENT '是否已读',
  created_at TIMESTAMP COMMENT '创建时间',
  FOREIGN KEY (project_id) REFERENCES project(id),
  FOREIGN KEY (submission_id) REFERENCES submission(id)
);



### 四、**新增Java实体类**

entity/
├── Project.java           # 外包项目
├── Submission.java        # 稿件
├── SubmissionAttachment.java # 稿件附件
├── Freelancer.java        # 自由职业者扩展信息
├── Enterprise.java        # 企业扩展信息
└── Message.java           # 消息

### 五、**新增/改造业务层**

service/
├── ProjectService.java          # 项目管理（发布、查询、筛选、编辑）
├── SubmissionService.java       # 稿件管理（投稿、审核、确定合作）
├── FreelancerService.java       # 自由职业者信息管理
├── EnterpriseService.java       # 企业信息管理
├── MessageService.java          # 消息服务
├── FileService.java             # 文件上传下载（扩展FileController）
└── (改造)UserService.java       # 用户注册改造（区分企业/自由职业者）

### 六、**新增/改造控制器**

controller/
├── ProjectController.java          # 项目相关API
├── SubmissionController.java       # 稿件相关API
├── FreelancerController.java       # 自由职业者信息API
├── EnterpriseController.java       # 企业信息API
├── MessageController.java          # 消息通信API
├── (改造)FileController.java       # 扩展文件权限控制
├── (改造)UserController.java       # 注册改造（支持两类用户）
└── AuthController.java             # 新增通用认证接口

### 七、**核心API接口清单**

#### **7.1 用户相关（改造）**

POST   /api/auth/register/freelancer      # 自由职业者注册
POST   /api/auth/register/enterprise      # 企业用户注册
POST   /api/auth/login                    # 登录（统一）
GET    /api/user/profile                  # 获取当前用户信息
PUT    /api/user/profile                  # 修改用户信息
PUT    /api/user/password                 # 修改密码

#### **7.2 项目管理（新增）**

POST   /api/projects                      # 企业发布项目
GET    /api/projects                      # 自由职业者查看项目列表（支持筛选）
GET    /api/projects/{id}                 # 获取项目详情
PUT    /api/projects/{id}                 # 企业编辑项目（仅发布者，未截止）
DELETE /api/projects/{id}                 # 删除项目（仅发布者，未截止）
GET    /api/projects/{id}/submissions     # 企业查看项目所有稿件
PUT    /api/projects/{id}/status          # 更新项目状态

#### **7.3 稿件管理（新增）**

POST   /api/submissions                   # 自由职业者提交稿件
GET    /api/submissions/my                # 自由职业者查看自己的稿件
GET    /api/submissions/{id}              # 查看稿件详情
DELETE /api/submissions/{id}              # 自由职业者撤回稿件（未被查看）
PUT    /api/submissions/{id}/status       # 企业改变稿件状态(INTERESTED/REJECTED)
PUT    /api/submissions/{id}/confirm      # 企业确定合作此稿件
GET    /api/submissions/{id}/freelancer   # 查看稿件提交者的作品集

#### **7.4 稿件附件（新增）**

POST   /api/submissions/{id}/attachments       # 上传附件（支持多文件）
GET    /api/attachments/{id}/download          # 下载附件（权限控制）
DELETE /api/attachments/{id}                   # 删除附件

#### **7.5 消息通信（新增）**

POST   /api/messages                      # 发送消息
GET    /api/messages/project/{projectId}  # 获取项目相关消息
GET    /api/messages/unread               # 获取未读消息
PUT    /api/messages/{id}/read            # 标记消息已读

#### **7.6 自由职业者信息（新增）**

GET    /api/freelancers/{id}              # 获取自由职业者信息
GET    /api/freelancers/{id}/portfolio    # 获取作品集
PUT    /api/freelancers/profile           # 编辑自己的信息

#### **7.7 企业信息（新增）**

GET    /api/enterprises/{id}              # 获取企业信息
PUT    /api/enterprises/profile           # 编辑企业信息

### 八、**权限控制改造**

| 操作     | User（求职者） | Freelancer（自由职业者） | Employ（企业） | Enterprise（企业扩展） | Admin |
| -------- | -------------- | ------------------------ | -------------- | ---------------------- | ----- |
| 发布项目 | ✗              | ✗                        | ✗              | ✓                      | ✓     |
| 提交稿件 | ✗              | ✓                        | ✗              | ✗                      | -     |
| 查看项目 | ✓              | ✓                        | ✗              | ✓                      | ✓     |
| 查看稿件 | ✗              | ✓(自己)                  | ✗              | ✓(自己项目)            | ✓     |
| 筛选稿件 | ✗              | ✗                        | ✗              | ✓                      | ✓     |
| 消息沟通 | ✗              | ✓                        | ✗              | ✓                      | -     |

------

### 九、**文件管理改造**

- **路径规划**：`/uploads/project/{projectId}/submission/{submissionId}/{filename}`

- 权限控制

  ：

  - 自由职业者：可下载自己提交的附件
  - 企业用户：可下载自己项目的所有稿件附件
  - 管理员：可下载所有附件

- **限制**：单文件≤50MB，单个稿件总附件≤200MB

------

### 十、**业务逻辑要点**

1. **项目状态流转**：PUBLISHED → CLOSED（截止） → CONFIRMED（确定合作）
2. **稿件状态流转**：SUBMITTED → INTERESTED/REJECTED → CONFIRMED（仅1份）
3. **自动更新**：截止时间到达时，自动关闭项目
4. **消息通知**：稿件被标记"有意向"时，自动发送通知给自由职业者
5. **撤销限制**：企业确定合作后，其他稿件自动改为"REJECTED"

------

### 十一、**技术改造点**

| 方面     | 现状           | 改造方案                                |
| -------- | -------------- | --------------------------------------- |
| 认证     | JWT（基础）    | JWT + 角色权限细分                      |
| 权限     | 简单的role字段 | 结合拦截器实现细粒度权限                |
| 文件上传 | 简单上传       | 添加权限控制 + 大小限制                 |
| 业务校验 | 基础           | 加强项目截止、稿件确认等逻辑            |
| 消息系统 | 无             | 新增实时消息模块（可基于WebSocket扩展） |

